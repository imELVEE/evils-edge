pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
function _init()
	cls()
	floor = 100
	player = {
		x = 10,
		y = floor,
		flip_bool = false,
		state = 'idle',
		gravity = true,
		
		idle_frames = {2,4},
		idle_frame = 1,
		idle_inc = 0.05,
		idle_limit = 3,
		
		run_frames = {32,34,36,38,40,42,44,46},
		run_frame = 1,
		run_inc = 0.25,
		run_limit = 8.9,
		
		
		crouch_frames = {6},
		
		jump_cycle = 0,
		cycle_limit = 8,
		jump_frames = {
			[1] = {8,10},
			[2] = {12,14},
			[3] = {64,66}
		},
		jump_style = rnd(jump_frames),
		jump_frame = 1,
		jump_inc = 0.1,
		jump_limit = 3,
	}
end

function _update()
	move(player)
	jump(player)
	gravity(player)
end

function _draw()
	cls()
	map()
	draw_sprite(player)
	print(player.state,32,60, 7)
end
-->8
// world logic
function gravity(unit)
	if (unit.jump_cycle >= unit.cycle_limit) then
		unit.gravity = true
	end

	if (unit.gravity) then
		if (unit.y < floor) then
			unit.y += 3
		else
			unit.y = floor
			unit.jump_cycle = 0
		end
	end
end
-->8
// animation logic
function draw_sprite(unit)
	palt(0, false)
	palt(15, true)
	
	if (unit.state == 'idle') then
		cycle_idle_frames(unit)
	elseif (unit.state == 'move') then
		cycle_move_frames(unit)
	elseif (unit.state == 'jump') then
		cycle_jump_frames(unit)
	else
		spr(96,unit.x,unit.y,2,2)
	end
	
	palt()
end

function cycle_idle_frames(unit)
	spr(unit.idle_frames[flr(unit.idle_frame)], unit.x, unit.y, 2, 2, unit.flip_bool)
	unit.idle_frame += unit.idle_inc
	if (unit.idle_frame >= unit.idle_limit) then
		unit.idle_frame = 1
	end
end
		
function cycle_move_frames(unit)
	spr(unit.run_frames[flr(unit.run_frame)], unit.x, unit.y, 2, 2, unit.flip_bool)
	unit.run_frame += unit.run_inc
	if (unit.run_frame >= unit.run_limit) then
		unit.run_frame = 1
	end
end

function cycle_jump_frames(unit)
	if (unit.y >= floor-3) then
		spr(unit.crouch_frames[1], unit.x, unit.y, 2, 2, unit.flip_bool)
	else
		spr(unit.jump_style[flr(unit.jump_frame)], unit.x, unit.y, 2, 2, unit.flip_bool)
		unit.jump_frame += unit.jump_inc
		if (unit.jump_frame >= unit.jump_limit) then
			unit.jump_frame = 1
		end
	end
end
-->8
// char logic
function move(unit)
	x_increment = 0
	
	if (unit.y == floor) then
		unit.state = 'move'
	end
	
	//right
	if (btn(1)) then
		unit.flip_bool = false
		x_increment = 3
	// left
	elseif (btn(0)) then
		unit.flip_bool = true
		x_increment = -3
	elseif (unit.state == 'move') then
		unit.state = 'idle'
	end
	
	// actually change character values
	if (unit.x + x_increment >= 112) then
		unit.x = 112
	elseif (unit.x + x_increment <= 0) then
		unit.x = 0
	else
		unit.x += x_increment
	end
end

function jump(unit)
	if (unit.y == floor) then
		unit.jump_style = rnd(unit.jump_frames)
	end

	if (btn(2)) then
		unit.state = 'jump'
	end
	
	if (unit.state == 'jump' and unit.jump_cycle < unit.cycle_limit) then
		unit.gravity = false
		unit.jump_cycle += 1
		unit.y -= (8-unit.jump_cycle)
	end
end	
		
		
		
		
__gfx__
0000000000000000fffffffff00fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
0000000000000000fffff0f00000fffffffffffff00ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00ffffffffffffff00fffff
0070070000000000ffff0ff0070fffffffff00f00000ffffffffffffffffffffffff0ffff00ffffffffffffff00fffffff70f0f00000f7ffff7f0ff00000f7ff
0007700000000000ffff0ff07b7ffffffff0fff0070fffffffff0ffffffffffffff0f0f00000fffffff0f0f00000fffffff80ff0070f2ffffff0f0f0070f2fff
0007700000000000fffffff777fffffffffffff07b7fffffffff0ffff00ffffffffffff0070fffffffff0ff0070fffffffff8ff07b72ffffffff8ff07b72ffff
0070070000000000ffffff88fffffffffffffff777fffffffffff0f00000fffffffffff07b7ffffffffffff07b7ffffffffff8f7772ffffffffff8f7772fffff
0000000000000000fffff8802fffffffffffff80fffffffffffffff0070ffffffffffff877fffffffffffff877ffffffffffff8828ffffffffffff8828ffffff
0000000000000000ffff8f808ffffffffffff8802ffffffffffffff07b7fffffffffff802fffffffffffff802fffffffffffff80ffffffffffffff80ffffffff
0000000000000000ffff8f802fffffffffff8f808ffffffffffffff777fffffffffff88052fffffffffff88052ffffffffffff80ffffffffffffff80ffffffff
0000000000000000fffff8802fffffffffff8f802ffffffffffff8882fffffffffffff8c022fffffffffff8c022fffffffffff80ffffffffffffff80ffffffff
0000000000000000ffffff7cf7fffffffffff87c2fffffffffff8f802ffffffffffffff872fffffffffffff872ffffffffffff8cffffffffffffff8cffffffff
0000000000000000ffffffccffffffffffffffccf7ffffffffff8f80f2ffffffffffff0c7dffffffffffff0c7dffffffffffffcfdfffffffffffffcfdfffffff
0000000000000000ffffffcdffffffffffffffcdfffffffffffff7fcdf7fffffffffff00dfffffffffffff00dffffffffffffcfffcfffffffffffcfffcffffff
0000000000000000ffffffcdffffffffffffffcdffffffffffffffffcdfffffffffffff0fffffffffffffff0ffffffffff0fcfffffdf0fffff0fcfffffdf0fff
0000000000000000ffffff00ffffffffffffff00ffffffffffffff0c0ffffffffffffffffffffffffffffffffffffffffff0fffffff0fffffff0fffffff0ffff
0000000000000000ffffff000fffffffffffff000fffffffffffff00f0ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
fffffffff00ffffffffffffffffffffffffffffff00ffffffffffffffffffffffffffffff00ffffffffffffffffffffffffffffff00fffffffffffffffffffff
fff0f0f00000fffffffffffff00fffffffff0ff00000fffffffffffff00ffffffff0f0f00000fffffffffffff00fffffffff0ff00000fffffffffffff00fffff
ffff0ff0070fffffffff00f00000fffffff0f0f0070ffffffff0fff00000ffffffff0ff0070fffffffff00f00000fffffff0f0f0070ffffffff0fff00000ffff
fffffff07b7ffffffff0fff0070ffffffffffff07b7fffffffff00f0070ffffffffffff07b7ffffffff0fff0070ffffffffffff07b7fffffffff00f0070fffff
ff888f8877fffffffffffff07b7fffffffffff8877fffffffffffff07b7fffffff228f8877ffffffffffffff7b7fffffffffff8877fffffffffffff07b7fffff
f7f888808fffffffffff888f77fffffffffff8808fffffffffff82ff77fffffff7f222808ffffffffffff2f877fffffffffff2808fffffffffff88f877ffffff
ffffff80228ffffffff8ff882fffffffffff88808fffffffffff2f888fffffffffffff80888fffffffff2f888fffffffffff22808ffffffffff8ff882fffffff
ffffff80f822f7fffff7fff802ffffffffff8f80ffffffffffff7ff808ffffffffffff80f888f7ffffff7ff808ffffffffff2f80ffffffffffff7ff802ffffff
fffff880fff82fffffffff88082f7fffffff88802fffffffffffff88088f7ffffffff880fff88fffffffff88088f7fffffff82808fffffffffffff88082f7fff
fffff8fccffffffffffff8dccff2fffffffff87cf27ffffffffff8fcfff8fffffffff8fcdffffffffffff8ccdff8fffffffff27cf86ffffffffff8fcfff2ffff
fffffffdfccccffffffffddffcccffffffffffcdffffffffffffffcfdffffffffffffffcfddddffffffffccffdddffffffffffdcffffffffffffffdfcfffffff
ff00ddddffffccffffffddfffffcffffffffffccdfffffffffffcccfddffffffff00ccccffffddffffffccfffffdffffffffffddcfffffffffffdddfccffffff
ff0ffffffffffcffffff0ffffff0fffffffffffcdffffffffff0fffffdffffffff0ffffffffffdffffff0ffffff0fffffffffffdcffffffffff0fffffcffffff
fffffffffffff0fffff0ffffff0ffffffffff00c0f0fffffff0fffffff0f0ffffffffffffffff0fffff0ffffff0ffffffffff00d0f0fffffff0fffffff0f0fff
fffffffffffff00fffff0ffffff0fffffffff0fff0fffffffff0fffffff0fffffffffffffffff00fffff0ffffff0fffffffff0fff0fffffffff0fffffff0ffff
fffffffff00fffffffff0ffff00fffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
fffff0f00000fffffffff0f00000ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
fff70ff00707ffffff7ffff0070fffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
fff8fff07b78fffffff8fff07b7f7fff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffff8ff7772ffffffff88ff777f8ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
fffff88822ffffffffff8888222fffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffff80ffffffffffffff80ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffff80ffffffffffffff80ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffff80ffffffffffff8880ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
fffff8f0fffffffffffffff0ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffff8ffcdffffffffffffffcdfffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffffcdffffffffffffffcfffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffff00cffffffffffffff0f0f0ffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffff0f0f0fffffffffff0fff0fffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
fffffffff0fffffffffffff0ffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffffffffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008777777800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00087777777780000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00877777787778000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00878778788778000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08778778787877800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08777887787877800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08777777777777800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08777887787777800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08778778788777800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00878778787878000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00877887787878000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00087777777780000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00008777777800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66666666555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
8080808080808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8181818181818181818181818181818180808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8181818181818181818181818181818180808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
8080808080808080808080808080808080808080808080808080808080800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
